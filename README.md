# xucf
ChineseChess

本文论述一个基于web技术的中国象棋在线复盘程序，同时设计中国象棋在线实时对战的程序。
程序设计首先从功能分析入手，目的是明确程序要做什么。对于网络上已有的中国象棋游戏程序的棋谱以及传统走棋叫法进行了一系列的调研，发现了各自之间的不同点和共同点。由此确定了程序的功能实现的大体方向，并明确了一系列功能，包括即时聊天、网络对战、悔棋、打谱、复盘等功能。程序的开发，完全照着这些功能开发下去。
功能分析完成后，再确定了客户端的实现方案，采用支持html5的浏览器作为客户端，以java开发的web服务为服务端的方案。使用javaScript设计棋盘的坐标系与棋子定义，同时使用css样式绘制棋盘和棋子。再设计好前端页面后，使用javaScript控制逻辑完成简单的游戏规则定义，走棋规则限制等，同时开辟多个切点，用于后期的后台功能切入。
前端大致工作完成后，开始设计后台服务基础设施，包含客户端的post请求处理，服务端主动推送消息给客户端的通讯方式。在此本程序采用了网络上的流行框架SSM（spring、springMVC、spring-mybatis），并搭建MySQL服务器，作为数据储存的持久化方式。使用websocket作为前后端即时通讯的服务设施，并处理了一系列关于线程安全方面的问题。
程序框架搭建完成后，开始设计数据交互方式。本程序定义统一使用JSON字符串交互，同时前后端分工需明确，并约定俗成一套规范，关于入参和出参的必要字段等。并在web服务中定义拦截器和利用java的ThreadLocal对象配合Map，简化了相关的接口调用的参数处理和pojo类的编写。
确定了数据交互，便开始设计走棋数据的编码。走棋数据编码就是将前端走棋所产生的数据，传送到服务端，服务端通过java代码编写一系列算法，将数据编码为中国象棋的传统走棋叫法。这一步是全文的两个关键之一。另一个是传统叫法的解码，即为将棋谱解析为前端程序所能识别的走棋动作数据。同时此处还做了一个关键的操作，就是通讯机制的完善，定义一套关于websocket的数据传输类型解析，将不同的消息，标记不同的type属性，用于前后端动态交互。
完成以上的棋谱编码和解码后，便开始完善程序，在悔棋方面，定义了一个模拟缓存类，用于方便处理数据零时存放和高速读写的相关事宜。同时完成各类不同棋谱导入检验解析的算法实现，虽然该算法不算非常的成功，但对于常见的一些棋谱信息，能够将其解析为程序所能读懂的棋谱，并通过复盘功能，解析出来。

